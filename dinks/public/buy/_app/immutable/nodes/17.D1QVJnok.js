import{g as z,l as ae}from"../chunks/localStore.svelte.6ix3im0n.js";import{r as F}from"../chunks/index.De_1-CT6.js";import{f as W}from"../chunks/fetcher.4lFdTOTx.js";import{a as p,t as S,c as K,b as oe}from"../chunks/disclose-version.BIyVqMZ8.js";import{p as re,l as ne,f as H,a as se,g as k,c as v,e as ie,r as y,s as I,M as Q,t as U}from"../chunks/runtime.DQwr1dzu.js";import{s as V}from"../chunks/render.CzK0qdHo.js";import{i as R}from"../chunks/if.D6id4Gaz.js";import{S as le,e as X,i as Y}from"../chunks/StepHeader.DOzchVb7.js";import{c as ce}from"../chunks/4.DfxuSM3A.js";import{C as de}from"../chunks/calendar.RBZLsofO.js";import{C as me}from"../chunks/Container.CbVs3Ov9.js";import{f as pe,d as fe}from"../chunks/utils.B-A_uK2n.js";import{B as ue}from"../chunks/Button.CAviRttS.js";import{S as ve}from"../chunks/StickyPay.D8ElPGKo.js";import{g as ye}from"../chunks/entry.DntabGLc.js";const _e=async()=>{var M,h;const t=z("booking");if(z("courts"),!((M=t==null?void 0:t.court_location)!=null&&M.name))throw F(300,"/buy/play-now");if(!(t!=null&&t.date))throw F(300,"/buy/play-now/date-time");if(!(t!=null&&t.player))throw F(300,"/buy/play-now/choose-players");const{morning:c=[],afternoon:e=[],evening:O=[]}=z("timeSlots")||{},{data:$=[]}=await W("/api/method/dinks.api.get_rates"),d=$.find(m=>{var f;return m.day.toLowerCase().includes(((f=t.weekday)==null?void 0:f.toLowerCase())||"")}),{data:g}=await W("/api/method/dinks.api.check_if_user_has_membership",{method:"POST",body:{phone:t.phone}}),T=((h=t.timeSchedules)==null?void 0:h.map(m=>{var D;const f=c.includes(m)?"Morning":e.includes(m)?"Afternoon":"Evening";let B=0;for(const C in(d==null?void 0:d.categories)||{})if(C.toLowerCase()==f.toLowerCase()){B=((D=d==null?void 0:d.categories)==null?void 0:D[C])||0;break}return B}).reduce((m,f)=>m+f,0))||0;return{totalPrice:g?(T*.8).toFixed(0):T,beforeDiscountPrice:g?T:0,hasMembership:g,timeGroups:{morning:c,afternoon:e,evening:O}}},Ee=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));var xe=S('<h4 class="mb-4 flex items-center justify-center gap-1 text-base font-bold"><!> Booking Details</h4>'),ge=S('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle opacity="0.1" cx="10" cy="10" r="10" fill="#321D1D"></circle></svg>'),he=S("<span> </span>"),be=S('<div class="flex items-center justify-between border-b border-solid border-secondary px-6 py-4"><p class="flex items-center gap-2 text-[13px] font-medium leading-[16px] text-secondary"><!> </p> <p class="flex flex-col text-sm font-bold leading-[16px] text-secondary"><!></p></div>'),we=S('<div class="relative rounded-xl border border-secondary px-5 py-10"><div class="absolute inset-x-0 -top-5 flex justify-center"><!></div> <!></div>'),Pe=S('<div class="flex flex-col gap-[40px]"><!> <!></div> <!>',1);function ze(t,c){var C;re(c,!0);let e=ae("booking",{});const O=async()=>{e.value.time_period=d(g);const{data:r,status:u}=await W("/api/method/dinks.api.get_payment_link",{method:"POST",body:{...e.value,amount:c.data.totalPrice}});if(u!==200){e.value.paylink&&(window.location=e.value.paylink);return}e.value.paylink=r,window.location=r};function $(){const r=e.value.timeSchedules||[],u=Object.values(c.data.timeGroups).flat(),a=new Map;let i=0;for(const o of u)a.set(o,i),i+=1;let _=[],j=0,b=0;r.sort();for(const[o,n]of a)for(const s of r)s===o&&(n-j!==1&&(b+=1),_[b]||(_[b]=[]),_[b].push(s),j=n);console.log("timeGroup",_);let w=_.map(o=>o.length===1?o[0]:`${o[0]}-${o[o.length-1]}`).filter(Boolean);return w=w.map(o=>{const[n,s]=o.split("-"),L=a.get(s)+1,P=u[L]||(s==="11:30 PM"?"12:00 AM":"")||(n==="11:30 PM"?"12:00 AM":"");return P?`${n}-${P}`:s?`${n}-${s}`:n}),w}const d=r=>{const u=r[0].replace(/^-.*$/,""),a=r[r.length-1].split("-"),i=a[a.length-1];return`${u} - ${i}`},g=$();e.value.time_period=d(g);const T={Location:((C=e.value.court_location)==null?void 0:C.location)||"",Date:pe(e.value.date||0,"w, dd WM yyyy"),Time:$(),Court:e.value.court_number?`Court ${e.value.court_number}`:"No preference","No. of Players":e.value.player===1?"1 Player":`${e.value.player} Players`,"Booking By":e.value.first_name+" "+e.value.last_name,Email:e.value.email,Phone:e.value.phone};ne(()=>{console.log(e.value,c.data)});var M=Pe(),h=H(M),m=v(h);le(m,{backUrl:"/buy/play-now/choose-players",headerText:"confirm your details",children:(r,u)=>{var a=xe(),i=v(a);de(i),ie(),y(a),p(r,a)},$$slots:{default:!0}});var f=I(m,2);me(f,{children:(r,u)=>{var a=we(),i=v(a),_=v(i);ue(_,{class:"w-max",text:"Booking Details",arrow:!1,action:()=>{}}),y(i);var j=I(i,2);X(j,17,()=>Object.entries(T),Y,(b,w)=>{let o=()=>k(w)[0],n=()=>k(w)[1];var s=be();const L=Q(()=>fe[o()]);var P=v(s),q=v(P);R(q,()=>k(L),x=>{var l=K(),A=H(l);ce(A,()=>k(L),(G,N)=>{N(G,{})}),p(x,l)},x=>{var l=ge();p(x,l)});var Z=I(q);y(P);var J=I(P,2),ee=v(J);R(ee,()=>Array.isArray(n()),x=>{var l=K(),A=H(l);X(A,17,n,Y,(G,N)=>{var E=he(),te=v(E);y(E),U(()=>V(te,k(N))),p(G,E)}),p(x,l)},x=>{var l=oe();U(()=>V(l,n())),p(x,l)}),y(J),y(s),U(()=>V(Z,` ${o()??""}`)),p(b,s)}),y(a),p(r,a)},$$slots:{default:!0}}),y(h);var B=I(h,2),D=Q(()=>c.data.totalPrice||0);ve(B,{action:O,actionSecond:()=>ye("/buy/play-now/confirmation?pay_at_court=1"),btnText:"pay now",get prevPrice(){return c.data.beforeDiscountPrice},get price(){return k(D)}}),p(t,M),se()}export{ze as component,Ee as universal};
